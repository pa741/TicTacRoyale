(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{3874:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return o(9455)}])},6291:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=o(8754),r=o(9867),a=o(1923),n=s._(o(997));class i{async OnEnter(){console.log("GAME LOGIC"),console.log("GAME LOGIC2");let e=(0,r.doc)(this.db,"rooms",this.room);var t=await (0,r.getDoc)(e);t.exists()?this.OnEnterExistingRoom(t):this.OnEnterNewRoom(),(0,r.onSnapshot)((0,r.doc)(this.db,"rooms",this.room),e=>{console.log("Current data: ",e.data());let t=e.data().turn===this.player;this.setBoard(this.getBoardLayout(e.data().board)),this.board=e.data().board,this.setTurn(t),this.turn=t,this.setPlayers(e.data().players),this.players=e.data().players,this.setWinner(e.data().winner)})}sendBoard(e){console.log("SEND BOARD"),console.log(e),console.log(this.player),console.log(this.room),console.log(this.players),(0,r.setDoc)((0,r.doc)(this.db,"rooms",this.room),{players:this.players,turn:this.getOtherPlayer(),board:e,created:Date().valueOf()})}sendHover(e){if(console.log("SEND HOVER"),this.players.length<2){console.log("NO PLAYERS");return}(0,r.updateDoc)((0,r.doc)(this.db,"rooms",this.room),{board:e})}constructor(e,t,o,s,i,l){this.board=["","","","","","","","",""],this.turn=!0,this.player="",this.players=[],this.db=(0,r.getFirestore)((0,a.initializeApp)(n.default)),this.OnEnterExistingRoom=async e=>{if(console.log("Document data:",e.data()),e.data().players.length>=2){console.log("ROOM FULL");return}e.data().created<Date().valueOf()-36e5&&this.CreateNewRoom();let t=[...e.data().players,this.player];console.log("NEW PLAYERS: "+t),(0,r.setDoc)((0,r.doc)(this.db,"rooms",this.room),{players:t,turn:e.data().turn,board:e.data().board,created:e.data().created})},this.OnEnterNewRoom=async()=>{console.log("No such document!"),this.CreateNewRoom()},this.CreateNewRoom=()=>(0,r.setDoc)((0,r.doc)(this.db,"rooms",this.room),{players:[this.player],turn:this.player,board:["","","","","","","","",""],created:Date().valueOf()}),this.getBoardLayout=e=>e.map((e,t)=>e===this.player?"X":""===e||void 0===e?"":"hover"===e?"hover":"O"),this.getOtherPlayer=()=>{var e;return null!==(e=this.players.filter(e=>e!==this.player)[0])&&void 0!==e?e:""},this.onClick=e=>{this.SetMove(e)},this.SetMove=e=>{if(console.log("CLICK: "+e),void 0!==this.board[e]&&""!==this.board[e]&&"hover"!==this.board[e]){console.log("NOT EMPTY");return}if(!this.turn){console.log("NOT YOUR TURN");return}let t=[...this.board];t[e]=this.player,this.sendBoard(t)},this.onMouseEnter=e=>{if(console.log("MOUSE ENTER"),""===this.board[e]||"hover"===this.board[e]){let t=[...this.board];t[e]="hover",this.sendHover(t);let o=this;setTimeout(()=>{if(console.log("MOUSE LEAVE"),"hover"==o.board[e]){console.log("MOUSE LEAVE2 ");let t=[...o.board];t[e]="",o.sendHover(t)}},400)}},this.player=e,this.room=t,this.setBoard=o,this.setTurn=s,this.setPlayers=i,this.setWinner=l}}e.exports=i},726:function(e,t,o){"use strict";let s=o(3832),r=o(6291);class a extends r{OnEnter(){console.log("GAME LOGIC AI")}sendHover(e){}sendBoard(e){this.setBoard(this.getBoardLayout(e)),this.setTurn(!1);let t=s(this.getBoardLayout(e));console.log("AI MOVE: "+t),-1!=t&&(e[t]="O",this.setBoard(this.getBoardLayout(e)),this.board=e,this.setTurn(!0));let o=this.checkWinner(e);o&&this.setWinner(o)}checkWinner(e){let t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let o=0;o<t.length;o++){let[s,r,a]=t[o];if(e[s]&&e[s]===e[r]&&e[s]===e[a])return e[s]}return null}constructor(e,t,o,s,r,a){super(e,t,o,s,r,a),r(["AI",e])}}e.exports=a},3832:function(e){"use strict";String.prototype.count=function(e){for(var t=0,o=0;o<this.length;o++)this[o]==e&&t++;return t},e.exports=function(e){let t;if(console.log("SpaceInBoard"),console.log(e),t=!1,e.forEach(e=>{console.log(e),(""==e||void 0==e||""==e)&&(t=!0)}),!t)return console.log("No hay espacio en el tablero"),-1;for(var o=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],s=[0,0,0,0,0,0,0,0,0],r=0;r<o.length;r++){let t=o[r],n=function(e,t){var o=0;let s="";for(var r=0;r<e.length;r++){let i=null!==(a=t[e[r]])&&void 0!==a?a:"";var a,n=s.count(i);if(""!=i&&""!=s){if(n!==s.length)return 0;n>0&&("O"==i&&(o+=100),"X"==i&&(o+=50))}switch(s+=i,i){case"O":o+=4;break;case"X":o+=2;break;default:o+=1}}return o}(t,e);for(var a=0;a<t.length;a++)""===e[t[a]]||void 0===e[t[a]]?s[t[a]]+=n:s[t[a]]=-1}for(var n=-1e3,i=0,r=0;r<s.length;r++)s[r]>n&&(n=s[r],i=r);return i}},997:function(e,t,o){"use strict";o.r(t),o(3977),o(9828),t.default={apiKey:"AIzaSyA3FFetP5jviPliqNJPwnKFmZZ5HDDdteM",authDomain:"tictactoeroyale.firebaseapp.com",projectId:"tictactoeroyale",storageBucket:"tictactoeroyale.appspot.com",messagingSenderId:"913682554953",appId:"1:913682554953:web:48ce760d29a45cfdbc1f98",measurementId:"G-315YB5165C"}},9455:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return j}});var s=o(5893),r=o(7294),a=o(7320),n=o.n(a),i=o(9332),l=o(1163),c=o(7632);o(3832);var d=o(6291),u=o.n(d),h=o(726),g=o.n(h),m=function(e){let t=n().square,o=e.value;return e.disabled&&(t+=" "+n().disabled),"hover"===e.value&&(t+=" "+n().hover,o=""),(0,s.jsxs)("div",{className:t,onClick:e.onClick,onMouseEnter:e.onMouseEnter,children:[(0,s.jsx)("div",{className:n().topwall,children:o}),(0,s.jsx)("div",{className:n().leftwall}),(0,s.jsx)("div",{className:n().rightwall})]})},_=function(e){let t=t=>(0,s.jsx)(m,{disabled:e.disabled,value:e.squares[t],onClick:()=>e.onClick(t),onMouseEnter:()=>e.onMouseEnter(t)});return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:n().boardRow,children:[t(0),t(1),t(2)]}),(0,s.jsxs)("div",{className:n().boardRow,children:[t(3),t(4),t(5)]}),(0,s.jsxs)("div",{className:n().boardRow,children:[t(6),t(7),t(8)]})]})},f=function(e){let{type:t}=e;return(0,s.jsx)("div",{className:n().fog+" "+t})},p=function(e){let{message:t,type:o,children:r}=e;console.log(r);let a=!1;return r&&r.map(e=>{e&&(a=!0)}),(0,s.jsx)(s.Fragment,{children:a&&(0,s.jsx)("div",{className:"".concat(n().NotificationBanner," ").concat(o),children:r})})},v=o(80),b=function(e){let{playWithAiCallback:t,roomCode:o,notificationCallback:r}=e;return(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"".concat(n().waitingForPlayers),children:[(0,s.jsx)("h2",{children:"Waiting for players"}),(0,s.jsx)("button",{className:"".concat(n().playAi),onClick:()=>{t()},children:"Play with AI"}),(0,s.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(o),r("Room code copied to clipboard.")},children:["Copy room code ",(0,s.jsx)(v.Z,{})]})]})})},y=o(5389),x=function(){return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"".concat(n().draw),children:(0,s.jsx)("h1",{children:"Draw"})})})},w=function(){return(0,s.jsx)("div",{className:"".concat(n().win),children:(0,s.jsx)("div",{children:(0,s.jsx)("h1",{children:"You Win"})})})},E=function(){return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"".concat(n().lose),children:(0,s.jsx)("h1",{children:"You Lose"})})})},j=()=>{let e=(0,l.useRouter)(),t=(0,i.useSearchParams)().get("room"),[o,a]=(0,r.useState)(null),[d,h]=(0,r.useState)(!1),[m,v]=(0,r.useState)(null),[j,N]=(0,r.useState)([]),[O,C]=(0,r.useState)(!1),[k,S]=(0,r.useState)([]),[R,A]=(0,r.useState)(null),[P,B]=(0,r.useState)(""),[M,T]=(0,r.useState)(!1),{asPath:L}=(0,l.useRouter)();return(0,r.useEffect)(()=>{let o=window.location.origin?window.location.origin:"";return"".concat(o).concat(L).indexOf("?room=")>-1||e.push("/"),null==m&&v((0,c.Z)()),null!=t&&"AI"!==t&&a(new(u())(m,t,N,C,S,A)),()=>{}},[t]),(0,r.useEffect)(()=>{},[k]),(0,r.useEffect)(()=>{o&&o.OnEnter()},[o]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:n().background,children:O&&(0,s.jsx)(f,{})}),(0,s.jsxs)("div",{className:n().container,children:[(0,s.jsxs)(p,{children:[k.length<2&&k.length>0&&(0,s.jsx)(b,{playWithAiCallback:()=>{h(!0),a(new(g())(m,t,N,C,S,A))},roomCode:t,notificationCallback:e=>{T(!0),B(e)}}),"draw"==R&&(0,s.jsx)(x,{}),R==m&&(0,s.jsx)(w,{}),R&&"draw"!==R&&R!==m&&(0,s.jsx)(E,{})]}),(0,s.jsx)("div",{className:n().table,children:o&&(0,s.jsx)(_,{disabled:!O||null!=R,squares:j,onClick:O&&null==R?o.onClick:()=>{},onMouseEnter:o.onMouseEnter})})]}),(0,s.jsx)(y.Z,{open:M,autoHideDuration:3e3,onClose:()=>T(!1),message:P})]})}},7320:function(e){e.exports={background:"game_background__jSE_j",home:"game_home__0teJX",homeForm:"game_homeForm__5VdkL",title:"game_title__QpmVW",waitingForPlayers:"game_waitingForPlayers__b1ZyW",playAi:"game_playAi__FE5Kc",container:"game_container__p2XiD",table:"game_table__5TOzb",square:"game_square__LDkB6",topwall:"game_topwall__Ckig1",fog:"game_fog__c_5LY",YourTurnPulse:"game_YourTurnPulse__oL2bt",error:"game_error__fXcot",win:"game_win__awiRm",yourTurn:"game_yourTurn__yTf_X",draw:"game_draw__YUX8p",NotificationBanner:"game_NotificationBanner__TPaX_",NotificationAppear:"game_NotificationAppear__YxBTY",disabled:"game_disabled__o4PVz",hover:"game_hover__M17S_",boardRow:"game_boardRow__GRdw3"}}},function(e){e.O(0,[16,883,741,427,774,888,179],function(){return e(e.s=3874)}),_N_E=e.O()}]);